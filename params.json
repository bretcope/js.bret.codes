{"name":"js.bret.codes","tagline":"JavaScript Tips and Style Guide","body":"Because JavaScript is a very dynamic language, it can lend itself to many different coding styles and paradigms. However, some paradigms are more maintainable or performant than others. The following is a very opinionated guide based on my personal experience maintaining large or long-running JS projects.\r\n\r\n__Table of Contents__\r\n\r\n* [Style Guide](#style-guide)\r\n    * [Braces](#braces)\r\n    * [Semicolons](#semicolons)\r\n    * [Indentation](#indentation)\r\n    * [Context Closures](#context-closures)\r\n    * [Quotes](#quotes)\r\n    * [Equivalence](#equivalence)\r\n    * [File Template](#file-template)\r\n    * [Naming](#naming)\r\n    * [Variable Declaration](#variable-declaration)\r\n    * [Function Declaration](#function-declaration)\r\n    * [Module Exports](#module-exports)\r\n    * [Require Statements](#require-statements)\r\n    * [Getters and Setters](#getters-and-setters)\r\n* [Code Validation](#code-validation)\r\n* [Third Party](#third-party)\r\n* [Performance](#performance)\r\n    * [Iterations](#iterations)\r\n    * [Conversions](#conversions)\r\n    * [Additional Reading](#additional-reading)\r\n* [Workflow](#workflow)\r\n    * [IDE](#ide)\r\n    * [When to use a git branch](#when-to-use-a-git-branch)\r\n\r\n## Style Guide\r\n\r\n### Braces\r\n\r\nBraces for code blocks generally get their own line, although closing braces are sometimes combined a closing parenthesis and semicolon. For literal object notation, the opening brace is placed on the same line as the assignment operator or return statement.\r\n\r\n```javascript\r\nif (test)\r\n{\r\n\t//do something\r\n}\r\nelse if (test2)\r\n{\r\n\t//do something\r\n}\r\nelse\r\n{\r\n\t//do something\r\n}\r\n\r\nswitch (item)\r\n{\r\n\tcase 1:\r\n\t\t//do something\r\n\t\tbreak;\r\n\tdefault:\r\n\t\t//do something\r\n\t\tbreak;\r\n}\r\n\r\ndo\r\n{\r\n\t//something\r\n}\r\nwhile (true);\r\n\r\nvar obj = {\r\n\tx: 1,\r\n\ty: 2,\r\n\tz: 3\r\n};\r\n\r\nfunction func ()\r\n{\r\n\treturn {\r\n\t\tx: 1,\r\n\t\ty: 2,\r\n\t\tz: 3\r\n\t};\r\n}\r\n\r\neventEmitter.on('error', function (error)\r\n{\r\n\t// ...\r\n});\r\n```\r\n\r\nOccasionally it's nice to omit the braces for very simple if statements, though people will have mixed feelings about this. Certainly you should not mix braces and no-braces within a single control flow (in other words, if the _if_ statement has braces, the _else_ should too, even if it could omit them).\r\n\r\n```javascript\r\nif (false)\r\n\treturn;\r\n```\r\n\r\nSimple one-line functions are also okay:\r\n\r\n```js\r\nfunction seven () { return 7; }\r\n```\r\n\r\n### Semicolons\r\n\r\nJust use them. Seriously, what are you, lazy?\r\n\r\n### Indentation\r\n\r\nUse ___tabs___ for _logical_ indentation, not spaces. In other words, tabs are used to denote code blocks. If you need to align text to specific columns beyond the code block indentation level, use spaces because that is not _logical_ indentation, that's actually visual markup.\r\n\r\n```javascript\r\nfunction x ()\r\n{\r\n\t// tab-indent to the code level\r\n\r\n\t//      use     spaces    to   line   up   comments if necessary\r\n\t//          1    2    3      4     5\r\n\tfunction y (one, two, three, four, five) {}\r\n}\r\n```\r\n\r\nThe typical JavaScript style uses two spaces for indentation. This simply isn't enough for me visually to line up blocks down the page at a glance, and therefore requires more mental effort to parse the code. Other people prefer this more condensed look. Tabs allows everyone to get the visual style they want without forcing their own preference on others.\r\n\r\n### Context Closures\r\n\r\nBecause the [this](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this) keyword is an odd little thing, it is often necessary to create an alias. ___Always___ name that alias variable `_this`. Some people use `self` or `that`, but the great thing about `_this` is that if you do a `ctrl-f` for `this.*`, it will always find what you were looking for regardless of whether the alias is being used.\r\n\r\n```javascript\r\nClass.prototype.funcA = function ()\r\n{\r\n\tvar _this = this;\r\n\tfunction innerFunction ()\r\n\t{\r\n\t\tvar x = _this.x * 7;\r\n\t\t//...\r\n\t}\r\n\t//...\r\n};\r\n```\r\n\r\n### Quotes\r\n\r\nFor string literals, single-quotes `'` are preferred over double-quotes `\"` primarily because hitting the shift key is hard. If your string needs to use literal single-quotes inside it, feel free to use double-quotes instead.\r\n\r\n```javascript\r\nvar str1 = 'basic string';\r\nvar str2 = \"It's annoying to have to escape the ' character, don't you think?\";\r\n```\r\n\r\n### Equivalence\r\n\r\nYou should almost always use `===` instead of `==`. There are a few limited instances where `==` may be desirable such as when comparing a number to a value which might not be a number, but may have an equivalent value. Even in that case, it may be better to convert the value to a number first. If you do use `==`, make sure you understand the consequences and have a good reason for doing so. You'll also have to disable the JsHint check for that block using inline configuration `/* jshint eqeqeq: false */`\r\n\r\n```javascript\r\nif (a === b) // good\r\nif (a == b)  // generally bad\r\n```\r\n\r\n### File Template\r\n\r\nI use the following template for most non-static JavaScript modules:\r\n\r\n```\r\n\"use strict\";\r\n/* -------------------------------------------------------------------\r\n * Require Statements << Keep in alphabetical order >>\r\n * ---------------------------------------------------------------- */\r\n\r\n//\r\n\r\n/* =============================================================================\r\n * \r\n * ModuleName - DESCRIPTION\r\n *  \r\n * ========================================================================== */\r\n\r\nmodule.exports = ModuleName;\r\n\r\nfunction ModuleName ()\r\n{\r\n}\r\n\r\n/* -------------------------------------------------------------------\r\n * Getters / Setters\r\n * ---------------------------------------------------------------- */\r\n\r\n//\r\n\r\n/* -------------------------------------------------------------------\r\n * Static Methods << Keep in alphabetical order >>\r\n * ---------------------------------------------------------------- */\r\n\r\n//\r\n\r\n/* -------------------------------------------------------------------\r\n * Prototype Methods << Keep in alphabetical order >>\r\n * ---------------------------------------------------------------- */\r\n\r\n//\r\n\r\n/* -------------------------------------------------------------------\r\n * Private Methods << Keep in alphabetical order >>\r\n * ---------------------------------------------------------------- */\r\n\r\n//\r\n\r\n```\r\n\r\nStatic modules follow a similar format, but don't typically include a constructor (use `var ModuleName = module.exports` instead) or the Prototype Methods section.\r\n\r\nNot all of the sections will be applicable for each new module, so feel free to edit or delete sections as necessary. Re-ordering of sections should be kept to a minimum, and you should have an actual reason for doing so.\r\n\r\nIf you decide the template does not apply at all to your file, at a minimum, keep the `\"use strict\";` at the very top of the file. Doing so ensures our code will be more future-proof, makes certain errors more apparent, and enables harmony features. For a more complete description of strict mode, see: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode\r\n\r\n### Naming\r\n\r\n`TitleCasing` for constructors (functions you would call with the `new` keyword) and namespaces, uppercase `SNAKE_CASING` for constants, and `camelCasing` for everything else.\r\n\r\n```javascript\r\nvar THIS_SHOULD_NOT_BE_CHANGED = \"don't do it\";\r\n\r\nfunction MyClass (x)\r\n{\r\n\tthis.member = x;\r\n}\r\n\r\nfunction myFunction (x)\r\n{\r\n\treturn x + 1;\r\n}\r\n\r\nvar myObj = new MyClass(1);\r\n```\r\n\r\n### Variable Declaration\r\n\r\nThere is no need to declare all of your variables at the top of a function. In fact, it is preferred to declare them where it is most logically relevant (such as just before its first use or assignment) in order to improve code readability.\r\n\r\n__Combining declarations__\r\n\r\nAnytime variable declaration is combined with an assignment, the declaration should not be combined with other variables. However, if multiple variables are being declared, but not assigned, they can, and probably should, be combined into a single declaration on one line.\r\n\r\n```javascript\r\nvar a, b, c;\r\nvar d = 8;\r\nvar e = 'e';\r\n```\r\n\r\nThe same is true for `require()` statements.\r\n\r\n```javascript\r\nvar ModuleA = require('module-a');\r\nvar ModuleB = require('module-b');\r\nvar ModuleC = require('module-c');\r\n```\r\n\r\nThis makes it very easy to add and remove variables, and no matter where you add or remove them, it will always create a one-line diff.\r\n\r\n__var vs. let__\r\n\r\nIf you run node with the `--harmony` flag, you can use certain ECMAScript6 features, such as [let](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let). Using `let` is a great idea... except there's one big problem: the V8 optimizer does not support it yet. This means the code will compile and run correctly, but will usually cause the entire function which encloses it to run slower (often a 2x performance difference). So, until V8 optimizes block-scoping, you should avoid using let/const in performance-critical code paths. However, generator functions are currently not optimized either, so feel free to use let/const inside generator functions without any additional performance penalties.\r\n\r\n### Function Declaration\r\n\r\nFor non-member functions (functions which are not attached to an object or prototype), __named functions are preferred__ over function pointers. The reason is because named functions can be called from anywhere inside the same scope, but function pointers can only be called after the point in code where the pointer is assigned.\r\n\r\n```javascript\r\nfuncA(); // <-- this will work because it's a named function\r\nfuncB(); // <-- this will not work because funcB is undefined\r\n\r\nfunction funcA () {}\r\nvar funcB = function () {}; // try not to do this much\r\n```\r\n\r\nRemember that named functions cannot be created in inner scopes (such as the inside of an if statement) according to the ES6 standard. V8 is not yet enforcing this, but it may eventually, and we should avoid doing so.\r\n\r\n```javascript\r\nfunction myFunction ()\r\n{\r\n\tfunction nestedInsideFunctionBlock () {} // OK\r\n\r\n\tif (test)\r\n\t{\r\n\t\tfunction nestedInsideInnerBlock () {} // BAD\r\n\t}\r\n}\r\n```\r\n\r\n### Module Exports\r\n\r\nDon't use `module.exports` more than once in a module, and ___never___ use the `exports` shortcut. Instead, create an alias or use a constructor.\r\n\r\nFor example, a module of static methods might do this:\r\n\r\n```javascript\r\nvar MyModule = module.exports;\r\nMyModule.funcA = function () {};\r\n```\r\n\r\nOr a constructor-style module might do this:\r\n\r\n```javascript\r\nmodule.exports = MyConstructor;\r\nfunction MyConstructor (x)\r\n{\r\n\tthis.x = x;\r\n}\r\n\r\nMyConstructor.prototype.funcA = function () {};\r\n```\r\n\r\nThe alias name should be the same name as what you would call the module when requiring it from elsewhere.\r\n\r\n```javascript\r\nvar MyModule = require('my-module');\r\nvar MyConstructor = require('my-constructor');\r\n```\r\n\r\n### Require Statements\r\n\r\nBecause a require statement generally returns a constructor or a namespace, it is preferred to use TitleCasing for most imported dependencies. The added benefit of using TitleCasing instead of camelCasing is that it helps prevent name collisions with local variables or arguments. The only time the imported variable name should be lowercase is when what you are importing is a function (this was JSHint doesn't complain that you're trying to call a constructor without `new`).\r\n\r\nFor example, you may want to use the argument name `path` in a function, but also want to call methods from the `path` module. Changing the require statement to `var Path = require('path');` facilitates both in a very intuitive and non-disruptive way.\r\n\r\n```javascript\r\nvar ChildProcess = require('child_process');\r\nvar Fs = require('fs');\r\nvar Path = require('path');\r\n```\r\n\r\n__Also:__ keep require statements in alphabetical order. It simply makes it a lot easier to see, at a glance, if the dependency you're looking for has already been included.\r\n\r\n### Getters and Setters\r\n\r\nJavaScript has several ways of defining getters and setters. Until the simple `get` and `set` syntax is optimized in V8, use [Object.defineProperty](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty) or [Object.defineProperties](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperties) to create getter and setter properties. `defineProperty` is preferred over `defineProperties` because it gives better autocomplete in WebStorm.\r\n\r\n```javascript\r\nfunction MyClass (miles)\r\n{\r\n\tthis.miles = miles;\r\n}\r\n\r\nObject.defineProperty(MyClass.prototype, 'nauticalMiles',\r\n{\r\n\tget: function () { return this.miles / 1.15; }\r\n});\r\n\r\nvar x = new MyClass(7);\r\nconsole.log(x.nauticalMiles); // 6.086956521739131\r\n```\r\n\r\n## Code Validation\r\n\r\nYou should consider using [JSHint](http://www.jshint.com/) and other tools to perform static analysis before deploying code.\r\n\r\n## Third Party\r\n\r\nThird party tools are great. It would take us forever to write anything if we weren't building off the shoulders of others. There are a few points to keep in mind when considering whether to include third party modules, and how to use them.\r\n\r\n### Before Including\r\n\r\nFirst, consider whether the module really adds functionality value, or is more equivalent to syntactic sugar. If it's the latter, be wary of how it will impact performance. In many cases, it is simply not worth including. On the other hand, if it solves a problem for you in less time than it would take for you to write your own solution, go for it.\r\n\r\nWe should try to remember to check the license before including a new dependency, although this can be a little bit difficult considering the nested dependencies. Luckily, almost everything in the Node.js world is MIT/BSD/Apache licensed, which is great for us.\r\n\r\n### Including\r\n\r\nAlways remember to use the `--save` flag when npm installing so that the dependency is automatically added to package.json.\r\n\r\n### Usage\r\n\r\n__Object Wrapping__\r\n\r\nDon't use third party libraries to wrap built-in objects. JavaScript's built-in `Date` object works great for almost everything you could need to do with dates, so don't use something like `moment()`. When a function specifies an argument like `startDate` it should be a `Date` object, or a number at the very least, not a `moment` object. However, what moment _is_ good at is formatting the output of a date. So if you have a need to output a date in a particular format, feel free to use moment for that, just don't pass the object around pretending it's a Date.\r\n\r\n__Syntax Sugar__\r\n\r\nTry not to get carried away with using libraries like [underscore](http://underscorejs.org/) for syntax sugar. Partly for readability, partly for performance, and partly because there are tools built-in to JavaScript to do the same things, only faster than the library can. Remember that, for server-side JavaScript, there is absolutely no need to worry about browser compatibility issues.\r\n\r\nFor example, don't use `_.keys(obj)`. Just use `Object.keys(obj)`.\r\n\r\nOn the other hand, `_.sample(arr, 6)` doesn't have a built-in counterpart, and may be a quick and readable way to sample elements from an array.\r\n\r\n__Moral of the story__\r\n\r\nGet to know the [Standard built-in objects](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects) and the [Node.js standard library](http://nodejs.org/api/) if you're not already pretty familiar with them. They can often do more than people realize at first.\r\n\r\n## Performance\r\n\r\nThis section provides some tips for writing more performant code.\r\n\r\n### Iterations\r\n\r\n__for...in__\r\n\r\n[for...in](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in) should generally not be used for Arrays, but is typically okay for objects. Keep in mind that for...in iterates over enumerable properties in the object's prototype, which may produce unexpected results. To only iterate over an object's own properties, use `Object.keys()` and then iterate over the returned array. This is faster than checking `.hasOwnProperty()` on each iteration.\r\n\r\n```javascript\r\nvar ownProps = Object.keys(obj);\r\nfor (var i = 0; i < ownProps.length; i++)\r\n{\r\n\tdoSomething(obj[ownProps[i]]);\r\n}\r\n```\r\n\r\n__for vs. forEach__\r\n\r\n[Array#forEach](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach) should usually be avoided. A good old fashion `for` loop is an order of magnitude faster and often easier to read. Even when all the loop does is call a function on every iteration, it is still drastically faster than the `forEach` method.\r\n\r\n```js\r\nfor (var i = 0; i < arr.length; i++)\r\n{\r\n\tdoSomething(arr[i]);\r\n}\r\n```\r\n\r\nIf you want a very slight performance improvement, on really long arrays, cache the `arr.length` into a local variable, and then use that in the loop condition instead.\r\n\r\n[jsperf: for vs. forEach](http://jsperf.com/se-for-vs-foreach)\r\n\r\n__Array Iterator Functions__\r\n\r\nWhat is true about `Array#forEach` is true for all of the Array iterator functions, such as [map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map). Consider that this code:\r\n\r\n```javascript\r\nvar copy = new Array(items.length);\r\nfor (var i = 0; i < items.length; i++)\r\n\tcopy[i] = items[i];\r\n```\r\n\r\nis orders of magnitude faster than:\r\n\r\n```javascript\r\nvar copy = items.map(function (item) { return item; });\r\n```\r\n\r\nSee: [jsperf: map vs for loop](http://jsperf.com/se-map-vs-for-loop)\r\n\r\nThis may not be a big deal when dealing with arrays with only a handful of elements in a code path which isn't executed repeatedly on every request. However, if there is any concern that the code path may produce a bottleneck, simply use a loop instead.\r\n\r\n__TL;DR__\r\n\r\nGood old fashion for loops are great. Any other form of iterating will _always_ hurt performance to some degree.\r\n\r\n### Conversions\r\n\r\n__Booleans__\r\n\r\n`!!val` is faster than `Boolean(val)`. [jsperf: !! vs. Boolean](http://jsperf.com/se-not-not-vs-boolean)\r\n\r\n__Numbers__\r\n\r\n`Number(val)` is faster than `+val` unless val is a string literal, or a local variable which was initialized from a string variable... but why would you ever create a string literal and then convert it back to a number? [jsperf: + vs Number](http://jsperf.com/se-plus-vs-number)\r\n\r\n`val|0` is marginally faster than `Math.floor(val)`. For large numbers, `Math.floor()` is safer.\r\n\r\n__Strings__\r\n\r\n`val+''` is faster than `val.toString()` or `String(val)`, however, it may have different behavior on objects which have both `valueOf()` and `toString()` methods defined. If there is any doubt about what type of object it is, `String(val)` is safer.\r\n\r\n### Additional Reading\r\n\r\n* [Optimization Killers](https://github.com/petkaantonov/bluebird/wiki/Optimization-killers)\r\n\r\n    Describes many of the scenarios which will prevent V8 from optimizing a function.\r\n* [Performance Tips for JavaScript in V8](http://www.html5rocks.com/en/tutorials/speed/v8/)\r\n\r\n    Describes how V8 uses \"hidden classes\" and what kinds of behavior hurt that optimization. It also links to a great talk by [Daniel Clifford at Google I/O 2012](http://www.youtube.com/watch?v=UJPdhx5zTaw) which covers much of the same ground as the article, but is well worth the watch if you have time.\r\n\r\n## Workflow\r\n\r\n### IDE\r\n\r\nIf you prefer to work in an IDE, [WebStorm](http://www.jetbrains.com/webstorm/) is recommended. You can download a 30-day trial, and a license is around $50.\r\n\r\n* Code completion\r\n* Integrated debugging\r\n* Git integration\r\n* Code inspection\r\n\r\nIf you do use WebStorm, consider downloading my pre-made [WebStormSettings.jar](https://github.com/bretcope/webstorm-settings) and importing some, or all, of the settings. Go to `File->Import Settings` and it will give you a window with several checkboxes allowing you to selectively import settings from the jar. In particular, if you want to use my codeing style, you should import the \"Code style schemes\" setting. After import, go to `File->Settings->Code Style` and select `Scheme: Bret` and apply. It also has a preset called `General` which is more similar to the typical JS style (two spaces, opening braces on the same line, etc) which may be useful for other projects.\r\n\r\n#### Debugging Node 0.11.x\r\n\r\nThere is a bug in 0.11.13 (which will be fixed in the next version) relating to inspecting globals. WebStorm, by default, tries to read globals when it starts debugging a process. This causes it to crash. The work-around is to tell WebStorm to not automatically load globals. Go to `IDE_INSTALLATION_DIR/bin` and edit the file ending in `.vmoptions`. Add the line:\r\n\r\n    -Djs.debugger.load.global.variables.on.start=false\r\n\r\nRestart WebStorm for the change to take effect.\r\n\r\n### When to use a git branch\r\n\r\nWhen working on a team where everyone has push access, most work should be done on the __master__ branch, and rebase is preferred over merging (`git pull --rebase`). Feature flags are preferred over branching. Separate branches should be used when a new feature or change is experimental, but only if it is unlikely to cause merge conflicts. Refactoring of existing code should ___never___ be done on a branch other than master. It is your responsibility to make sure your branch stays up to date with master during development (use `git pull origin master` to merge changes from master into your branch).\r\n\r\nPull requests are a great way to do code reviews, however, there are other ways of asking for code reviews for simple things, such as drop a link to the diff in chat before deploying production. So don't feel like a PR is the only way to get a second set of eyes on something.","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}